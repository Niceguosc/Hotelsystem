<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/dashboard.css" rel="stylesheet">

    <link rel="stylesheet" href="/css/jquery-ui.min.css"/>
    <script src="/js/jquery-1.12.3.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/pageNav.js"></script>
</head>
<body>


<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">酒店管理面板</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">退出登录</a></li>
            </ul>

        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul id="main-nav" class="nav nav-tabs nav-stacked" style="">
                <li class="active">
                    <a href="/Administration">
                        <i class="glyphicon glyphicon-th-large"></i>
                        酒店管理
                    </a>
                </li>
                <li>
                    <a href="/living">
                        <i class="glyphicon glyphicon-credit-card"></i>
                        大堂入住
                    </a>
                </li>
                <li>
                    <a href="/">
                        <i class="glyphicon glyphicon-globe"></i>
                        订单入住
                    </a>
                </li>
                <li>
                    <a href="/">
                        <i class="glyphicon glyphicon-globe"></i>
                        退房管理
                    </a>
                </li>
                <li>
                    <a href="/">
                        <i class="glyphicon glyphicon-globe"></i>
                        入住记录查询
                    </a>
                </li>
                <li>
                    <a href="#systemSetting" class="nav-header collapsed" data-toggle="collapse">
                        <i class="glyphicon glyphicon-cog"></i>
                        房间管理
                        <span class="pull-right glyphicon glyphicon-chevron-down"></span>
                    </a>
                    <ul id="systemSetting" class="nav nav-list collapse secondmenu" style="height: 0px;">
                        <li><a href="/house"><i class="glyphicon glyphicon-user"></i>查询房间信息</a></li>
                        <li><a href="/list"><i class="glyphicon glyphicon-th-list"></i>新建房间</a></li>
                        <li><a href="/add"><i class="glyphicon glyphicon-asterisk"></i>删除房间</a></li>
                    </ul>
                </li>

                <li>
                    <a href="/classification">
                        <i class="glyphicon glyphicon-calendar"></i>
                        房间类别
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="glyphicon glyphicon-fire"></i>
                        修改密码
                    </a>
                </li>
            </ul>
        </div>


        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal">
                +增加分类
            </button>
            <button type="button" class="btn btn-danger btn-md" data-toggle="modal" data-target="#myModal4">
                删除
            </button>
            <button type="button" id="bian" class="btn btn-primary btn-md" data-toggle="modal" data-target="#myModal1">
                修改
            </button>

            <!-- Modal -->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                        aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">添加菜类</h4>
                        </div>
                        <div class="modal-body">
                            <form id="biaodan" action="/doadd" method="post">
                                <p>类别名称：<input type="text" name="name"/></p>
                                <p>面积 : <input type="number" name="Area"></p>
                                <p>床位数 : <input type="number" name="Bed"></p>
                                <p>早餐 : <select name="Breakfast" id="Breakfast">
                                        <option value="是">是</option>
                                        <option value="否">否</option>
                                    </select>
                                </p>
                                <p>网络 :
                                    <select name="Net" id="Net">
                                        <option value="是">是</option>
                                        <option value="否">否</option>
                                    </select>
                                </p>
                                <p>电视 :
                                    <select name="Tv" id="Tv">
                                        <option value="是">是</option>
                                        <option value="否">否</option>
                                    </select>
                                </p>
                                <p>
                                    价格 :<input type="number" name="price">
                                </p>
                                <p>
                                    房间数量 : <input type="number" name="RoomAmount">
                                </p>
                                <p>
                                    剩余数量 : <input type="number" name="LAmount">
                                </p>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="btn">ok</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal -->
            <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                        aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">编辑</h4>
                        </div>
                        <div class="modal-body">
                            <div id="bjyg">

                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="bcgg">ok</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Modal -->
            <div class="modal fade" id="myModal4" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                        aria-hidden="true">&times;</span></button>
                            <h4 class="modal-title" id="myModalLabel">删除</h4>
                        </div>
                        <div class="modal-body">
                            <p>真的要删除?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary shan  ">ok</button>
                        </div>
                    </div>
                </div>
            </div>

            <table class="table  table-bordered navbar-default" style="margin-top: 50px;">
                <tr>
                    <th></th>
                    <th>房间类别</th>
                    <th>类别名称</th>
                    <th>面积</th>
                    <th>床位数</th>
                    <th>早餐</th>
                    <th>网络</th>
                    <th>电视</th>
                    <th>价格</th>
                    <th>房间数量</th>
                    <th>剩余数量</th>

                </tr>

                <tbody id="tbody"></tbody>
            </table>
            <div id="pagenavbox"></div>
        </div>
    </div>
</div>


<script>
    $("#btn").click(function () {
        $.post("/doadd", {
            name: $("input[name=name]").val(),
            Area: $("input[name=Area]").val(),
            Bed: $("input[name=Bed]").val(),
            Breakfast: $("#Breakfast").val(),
            Net: $("#Net").val(),
            Tv: $("#Tv").val(),
            price: $("input[name=price]").val(),
            RoomAmount: $("input[name=RoomAmount]").val(),
            LAmount: $("input[name=LAmount]").val()

        }, function (data) {
            if (data.result == 1) {
                alert("提交成功！");
                window.location.href = '/classification';
                $("input[type=text]").val("");
            } else if (data.result == -1) {
                alert("提交失败，类别名被占用！");
            } else if (data.result == -2) {
                alert("服务器错误！请联系管理员，怎么联系我也不知道！");
            }
        })
    });

    $("#tbody").delegate(".delbtn", "click", function () {
        $(".shan").click(function () {
            $(this).modal('hide');
            var id = $("input[name=timu]:checked").attr("data-id");
            var $this = $(this);

            $.ajax({
                url: "/doadd/" + id,
                type: "delete",
                success: function (data) {
                    if (data.result == 1) {
                        alert("删除成功");
                        $this.parents("tr").remove();
                        window.location.href = '/classification'
                    } else {
                        alert("服务器错误！");
                    }
                }
            });
        })
    })
    $.get("/doadd?page=1", function (data) {
        //分页条
        new PageNav({
            boxid: "pagenavbox",
            page: 1,
            pageAmount: data.pageAmount,
            change: function (pagenumber) {
                gotopage(pagenumber);
            }
        });

        gotopage(1);
    });
    // gotopage()

    //Ajax请求，请求JSON数据
    function gotopage(pagenumber) {
        //清空
        $("#tbody").empty();

        //获得新的数据
        $.get("/doadd?page=" + pagenumber, function (data) {

            var num = 1;
            $("#tbody").html(' ')
            $.each(data.results, function (i, n) {
                $tr = $("<tr class='shows update'></tr>");
                $("<td><input type='radio' class='delbtn show update' name='timu' data-id='" + n._id + "'/></td>").appendTo($tr);
                $("<td></td>").html("0" + num++).appendTo($tr);
                $("<td></td>").html(n.name).appendTo($tr);
                $("<td></td>").html(n.Area).appendTo($tr);
                $("<td></td>").html(n.Bed).appendTo($tr);
                $("<td></td>").html(n.Breakfast).appendTo($tr);
                $("<td></td>").html(n.Net).appendTo($tr);
                $("<td></td>").html(n.Tv).appendTo($tr);
                $("<td></td>").html(n.price).appendTo($tr);
                $("<td></td>").html(n.RoomAmount).appendTo($tr);
                $("<td></td>").html(n.LAmount).appendTo($tr);

                $tr.appendTo($("#tbody"));
            })
        });
    }

    $("#tbody").delegate(".update", "click", function () {

        var id = $("input[name=timu]:checked").attr("data-id");
        $.ajax({
            url: "/doadd/" + id,
            type: "get",
            success: function (data) {
                console.log(data.update);
                //     var dt=data.results
                if (data.result == -1) {
                    alert("服务器错误");
                } else {
                    $('#bjyg').html('<form><p><span>类别名称:</span><input type="text" class="nm" name="name" value="' + data.update[0].name + '" disabled></p><p><span>面积:</span><input type="text" name="Area" class="Area" value="' + data.update[0].Area + '"></p><p><span>床位数：</span><input type="text" name="Bed" class="Bed" value="' + data.update[0].Bed + '"></p><p>早餐:<select name="Breakfast" class="Breakfast"><option value="是">是</option><option value="否">否</option></select></p><p>网络:<select name="Net" class="Net"><option value="是">是</option><option value="否">否</option></select></p><p>电视:<select name="Tv" class="Tv"><option value="是">是</option><option value="否">否</option></select><p><span>价格:</span><input type="text" name="price" class="price" value="' + data.update[0].price + '"></p><p><span>房间数量:</span><input type="text" name="RoomAmount" class="RoomAmount" value="' + data.update[0].RoomAmount + '"></p><p><span>剩余数量:</span><input type="text" name="LAmount" class="LAmount" value="' + data.update[0].LAmount + '"></p></form>')
                }
            }
        });
    })


    $('#bcgg').click(function () {
        var id = $("input[name=timu]:checked").attr("data-id");

        $.post("/doadd/" + id, {
            name: $(".nm").val(),
            Area: $(".Area").val(),
            Bed: $(".Bed").val(),
            Breakfast: $(".Breakfast").val(),
            Net: $(".Net").val(),
            Tv: $(".Tv").val(),
            price: $(".price").val(),
            RoomAmount: $(".RoomAmount").val(),
            LAmount: $(".LAmount").val()


        }, function (data) {
            if (data.result == 1) {
                alert("修改成功！");
                window.location = "/classification";
            } else {
                alert("服务器错误！请联系管理员，怎么联系我也不知道！");
            }
        })
    })
</script>
</body>
</html>